<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Correct Color Picker</title>

  <link rel="stylesheet" href="Assets/CSS/reset.css">
  <!-- Bootstrap File -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="Assets/CSS/style.css">
  <!-- JQuery -->
  <script src="https://code.jquery.com/jquery.js"></script>

  <style>
    #rand-target-color,
    #color-picker li {
      font-size: 24px;
    }
  </style>

</head>
<body>

    <div class="container"> 
        <div class="row justify-content-center"><div class="col-4"  id="playerJedi"></div></div>

        <div class="row justify-content-center"><div class="col-4 text"  id="textField"></div></div>

        <div class="row justify-content-center"><div class="col-4"  id="enemyJedi"></div></div>

        <div class="row justify-content-center"><div class="col-4"><button class="button" id="fight">FIGHT</button></div></div>

        <div class="row justify-content-center" id="replay"><div class="col-4"><button class="button">Replay</button></div></div>

        <div class="row justify-content-center"><div class="col-4 text"  id="textField2"></div></div>

        <div class="row justify-content-center" id="pickJedi"><div class="col-3"  id="pickJedi0"></div>
                                                              <div class="col-3"  id="pickJedi1"></div>
                                                              <div class="col-3"  id="pickJedi2"></div>
                                                              <div class="col-3"  id="pickJedi3"></div></div>

        <div class="row justify-content-center" id="pickEnemyJedi"><div class="col-4"  id="pickEnemyJedi0"></div>
                                                                   <div class="col-4"  id="pickEnemyJedi1"></div>
                                                                   <div class="col-4"  id="pickEnemyJedi2"></div></div>
        
    </div>

    <script>

    // JavaScript function that wraps everything
    $(document).ready(function() 
    {
        var gameInfo = {
            jediList: new Map(),
            playerJedi: null,
            gameState: "",
            curEnemy: null,
            pickableJedi: new Map()
        };
        
        function jedi(initName = "", initImage = "", initStartHp = 0, initAttack = 0, initCounterAtk = 0)
        {
            this.name = initName;
            this.image = initImage
            this.startHp = initStartHp;
            this.hp = initStartHp;
            this.baseAtk = initAttack;
            this.currentAtk = initAttack;
            this.counterAtk = initCounterAtk;
            
            this.print = function()
            {
                return "<img class=\"jedi\" src=\"" + this.image + "\" jediName=\"" + this.name + "\">" +
                       "<div class=\"label\">Name: " + this.name + "<br>HP: " + this.hp + "</div>";
            };

            this.isDead = function()
            {
                if(this.hp <= 0)
                {
                    return true;
                }
                return false;
            };

            this.reInit = function()
            {
                this.hp = this.startHp;
                this.currentAtk = this.baseAtk;
            
            };

            this.attack = function()
            {
                var temp = this.currentAtk;
                this.currentAtk += this.baseAtk;
                return temp;
            };

            this.counter = function()
            {
                return this.counterAtk;
            };

            this.takeDmg = function(atk)
            {
                this.hp -= atk;
                return this.isDead();
            };
            
            return this;
        }


        function createJedi(name)
        {
            switch(name)
            {
                case "Obi-Wan Kenobi":
                    return new jedi("Obi-Wan Kenobi", "Assets/Images/obiwan.jpg", 125, 3, 5);
                case "Luke Skywalker":
                    return new jedi("Luke Skywalker", "Assets/Images/lukeskywalker.jpg", 145, 3, 3);
                case "Darth Vader":
                    return new jedi("Darth Vader", "Assets/Images/darthvader.jpg", 150, 1, 4);
                case "Darth Maul":
                    return new jedi("Darth Maul", "Assets/Images/darthmaul.jpg", 160, 2, 3);
                default:
                    return "Error jedi not found";
            }
        }
        

        function populatePickList(mapToPop)
        {
            mapToPop.set("Obi-Wan Kenobi", createJedi("Obi-Wan Kenobi"));
            mapToPop.set("Luke Skywalker", createJedi("Luke Skywalker"));
            mapToPop.set("Darth Vader", createJedi("Darth Vader"));
            mapToPop.set("Darth Maul", createJedi("Darth Maul"));
        }

        function pickJedi(jediPicked, mapIn)
        {
            var temp = mapIn.get(jediPicked);
            mapIn.delete(jediPicked);
            return temp;
        }

        function load()
        {
            populatePickList(gameInfo.jediList);
            init();
            gameInfo.gameState = "pickChar";
        }

        function init()
        {
            for(let i of gameInfo.jediList)
            {
                gameInfo.pickableJedi.set(i[0], i[1]);
            }
            
        }
        
        function reset()
        {
            gameInfo.playerJedi = null;
            init();
            for(let i of gameInfo.jediList.values())
            {
                i.reInit();
            }
            gameInfo.gameState = "pickChar";
        }

        function clearScreen()
        {
            $("#pickJedi0").empty();
            $("#pickJedi1").empty();
            $("#pickJedi2").empty();
            $("#pickJedi3").empty();
            $("#playerJedi").empty();
            $("#enemyJedi").empty();
            $("#pickEnemyJedi0").empty();
            $("#pickEnemyJedi1").empty();
            $("#pickEnemyJedi2").empty();
            $("#textField").empty();
            $("#textField2").empty();
            $("#fight").hide();
            $("#replay").hide();
        }
        
        function draw(gS)
        {
            clearScreen();
            var j = 0;
            switch(gS)
            {
                
                case "pickChar":
                    
                    for(let i of gameInfo.pickableJedi.values())
                    {
                        $("#pickJedi" + j++).append(i.print());
                    }
                    $("#textField").text("Pick Your Jedi");
                    

                    break;

                case "pickAttacker":

                    $("#playerJedi").append(gameInfo.playerJedi.print());


                    for(let i of gameInfo.pickableJedi.values())
                    {
                        $("#pickEnemyJedi" + j++).append(i.print());
                    }

                    $("#textField").text("Pick your enemy");
                    break;

                case "fight":
                    $("#fight").show();
                    for(let i of gameInfo.pickableJedi.values())
                    {
                        $("#pickEnemyJedi" + j++).append(i.print());
                    }
                    $("#playerJedi").append(gameInfo.playerJedi.print());

                    $("#enemyJedi").append(gameInfo.curEnemy.print());
                    $("#textField").text("Versus");
                    $("#textField2").text("Enemies remaining");
                    break;

                case "win":
                    $("#textField").text("You Win, Replay?");
                    $("#replay").show();
                    break;

                case "loss":
                    $("#textField").text("You Lose, Replay?");
                    $("#replay").show();
                    break;
            }
                
        }

        load();
        draw(gameInfo.gameState);

        $("#pickJedi").click(function(event) 
        {
            if(gameInfo.gameState == "pickChar")
            {
                var jedi = $(event.target).attr("jediname");
                if(jedi)
                {
                    gameInfo.playerJedi = pickJedi(jedi, gameInfo.pickableJedi);
                    gameInfo.gameState = "pickAttacker";
                    draw(gameInfo.gameState);
                }
                
            }
        });

        $("#pickEnemy").click(function(event) 
        {
            if(gameState == "pickAttacker")
            {
                var jedi = $(event.target).attr("jediName");
                if(jedi)
                {
                    gameInfo.curEnemy = pickJedi(jedi, gameInfo.pickableJedi);
                    gameInfo.gameState = "Fight";
                    draw(gameInfo.gameState);
                }
            }
        });

        $("#pickEnemyJedi").click(function(event) 
        {
            if(gameInfo.gameState == "pickAttacker")
            {
                var jedi = $(event.target).attr("jediname");
                if(jedi)
                {
                    gameInfo.curEnemy = pickJedi(jedi, gameInfo.pickableJedi);
                    gameInfo.gameState = "fight";
                    draw(gameInfo.gameState);
                }
            }
        });

        $("#fight").click(function(event) 
        {
            if(gameInfo.gameState == "fight")
            {
                if(gameInfo.curEnemy.takeDmg(gameInfo.playerJedi.attack()))
                {
                    if(gameInfo.pickableJedi.size == 0)
                    {
                        gameInfo.gameState = "win";
                    }
                    else
                    {
                        gameInfo.gameState = "pickAttacker";
                    }
                    
                }
                else if(gameInfo.playerJedi.takeDmg(gameInfo.curEnemy.counter()))
                {
                    gameInfo.gameState = "loss";
                }
                draw(gameInfo.gameState);
            }
        });


        $("#replay").click(function(event) 
        {
            reset();
            draw(gameInfo.gameState);
        });

        

    });

    </script>
</body>
</html>
