<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Correct Color Picker</title>

  <!-- Bootstrap File -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">

  <!-- JQuery -->
  <script src="https://code.jquery.com/jquery.js"></script>

  <style>
    #rand-target-color,
    #color-picker li {
      font-size: 24px;
    }
  </style>

</head>
<body>

    <div class="container"> 
        <div id="playerJedi"></div>
        <div id="textField"></div>
        <div id="enemyJedi"></div>
        <button id ="fight">FIGHT</button>
        <div id="textField2"></div>
        
        <div id="pickJedi"></div>
        <div id="pickEnemyJedi"></div>
        
    </div>

    <script>

    // JavaScript function that wraps everything
    $(document).ready(function() 
    {
        var jediList = new Map();
        var playerJedi = null;
        var gameState = "";
        var curEnemy = null;
        var pickableJedi = new Map();
        function jedi(initName = "", initImage = "", initStartHp = 0, initAttack = 0, initCounterAtk = 0)
        {
            this.name = initName;
            this.image = initImage;
            this.startHp = initStartHp;
            this.hp = initStartHp;
            this.baseAtk = initAttack;
            this.currentAtk = initAttack;
            this.counterAtk = initCounterAtk;
            this.isDead = function()
            {
                if(this.hp <= 0)
                {
                    return true;
                }
                return false;
            };

            this.reInit = function()
            {
                this.hp = this.startHp;
                this.currentAtk = this.baseAtk;
            
            };

            this.attack = function()
            {
                var temp = this.currentAtk;
                this.currentAtk += this.baseAtk;
                return temp;
            };

            this.counter = function()
            {
                return this.counterAtk;
            };

            this.takeDmg = function(atk)
            {
                this.hp -= atk;
                return this.isDead();
            };
            
            return this;
        }


        function createJedi(name)
        {
            switch(name)
            {
                case "Obi-Wan Kenobi":
                    return new jedi("Obi-Wan Kenobi", "Assets/Images/obiwan.jpg");
                    break;
                case "Luke Skywalker":
                    return new jedi("Luke Skywalker", "Assets/Images/lukeskywalker.jpg");
                    break;
                case "Darth Vader":
                    return new jedi("Darth Vader", "Assets/Images/darthvader.jpg");
                    break;
                case "Darth Maul":
                    return new jedi("Darth Maul", "Assets/Images/darthmaul.jpg");
                    break;
                default:
                    return "Error jedi not found";
            }
        }
        

        function populatePickList(mapToPop)
        {
            mapToPop.set("Obi-Wan Kenobi", createJedi("Obi-Wan Kenobi"));
            mapToPop.set("Luke Skywalker", createJedi("Luke Skywalker"));
            mapToPop.set("Darth Vader", createJedi("Darth Vader"));
            mapToPop.set("Darth Maul", createJedi("Darth Maul"));
        }

        function pickJedi(jediPicked, mapIn)
        {
            var temp = mapIn.get(jediPicked);
            mapIn.delete(jediPicked);
            return temp;
        }

        function load()
        {
            populatePickList(jediList);
            init();
            gameState = "pickChar";
            draw();
        }

        function init()
        {
            for(let i of jediList)
            {
                pickableJedi.set(i[0], i[1]);
            }
            
        }
        
        function reset()
        {
            playerJedi = null;
            init();
            for(let i of jediList.values())
            {
                i.reInit();
            }
            gameState = "pickChar";
        }

        function clearScreen()
        {
            $("#pickJedi").empty();
            $("#playerJedi").empty();
            $("#enemyJedi").empty();
            $("#pickEnemyJedi").empty();
            $("#textField").empty();
            $("#textField2").empty();
            $("#fight").hide();
        }
        
        function draw()
        {
            clearScreen();
            switch(gameState)
            {
                case "pickChar":
                    
                    for(let i of pickableJedi.values())
                    {
                        $("#pickJedi").append("<img src=\"" + i.image + "\" jediName=\"" + i.name + "\">");
                    }
                    $("#textField").text("Pick Your Jedi");
                    
                    //disable other graphics

                    break;

                case "pickAttacker":

                    $("#playerJedi").append("<img src=\"" + playerJedi.image + "\" jediName=\"" + playerJedi.name + "\">");
                    for(let i of pickableJedi.values())
                    {
                        $("#pickEnemyJedi").append("<img src=\"" + i.image + "\" jediName=\"" + i.name + "\">");
                    }

                    $("#textField").text("Pick your enemy");
                    break;

                case "fight":
                    $("#fight").show();
                    for(let i of pickableJedi.values())
                    {
                        $("#pickEnemyJedi").append("<img src=\"" + i.image + "\" jediName=\"" + i.name + "\">");
                    }
                    $("#playerJedi").append("<img src=\"" + playerJedi.image + "\" jediName=\"" + playerJedi.name + "\">");

                    $("#enemyJedi").append("<img src=\"" + curEnemy.image + "\" jediName=\"" + curEnemy.name + "\">");
                    $("#textField").text("Versus");
                    $("#textField2").text("Enemies remaining");
                    break;

                case "win":
                    break;

                case "loss":
                    break;
            }
                
        }

        load();
        init();

        $("#pickJedi").click(function(event) 
        {
            if(gameState == "pickChar")
            {
                var jedi = $(event.target).attr("jediname");
                playerJedi = pickJedi(jedi, pickableJedi);
                gameState = "pickAttacker";
                draw();
            }
        });

        $("#pickEnemyJedi").click(function(event) 
        {
            if(gameState == "pickAttacker")
            {
                var jedi = $(event.target).attr("jediname");
                curEnemy = pickJedi(jedi, pickableJedi);
                gameState = "fight";
                draw();
            }
        });

        $("#fight").click(function(event) 
        {
            if(gameState == "fight")
            {
                if(curEnemy.takeDmg(playerJedi.attack()))
                {
                    if(pickableJedi.size == 0)
                    {
                        gameState = "win";
                    }
                    else
                    {
                        gameState = "pickAttacker";
                    }
                    
                }
                else if(playerJedi.takeDmg(curEnemy.counter()))
                {
                    gameState = "loss";
                }
                console.log(playerJedi.hp);
                console.log(curEnemy.hp);
                draw();
            }
        });


        $("#replay").click(function(event) 
        {
            reset();
            draw();
        });

        $("#pickEnemy").click(function(event) 
        {
            if(gameState == "pickAttacker")
            {
                var jedi = $(event.target).attr("jediName");
                curEnemy = pickJedi(jedi, pickableJedi);
                gameState = "Fight";
                draw();
            }
        });

    });

    </script>
</body>
</html>
